var Nanobar=function(){var c,d,e,f,g,h,k={width:"100%",height:"4px",zIndex:9999,top:"0"},l={width:0,height:"100%",clear:"both",transition:"height .3s"};c=function(a,b){for(var c in b)a.style[c]=b[c];a.style["float"]="left"};f=function(){var a=this,b=this.width-this.here;0.1>b&&-0.1<b?(g.call(this,this.here),this.moving=!1,100==this.width&&(this.el.style.height=0,setTimeout(function(){a.cont.el.removeChild(a.el)},300))):(g.call(this,this.width-b/4),setTimeout(function(){a.go()},16))};g=function(a){this.width=
a;this.el.style.width=this.width+"%"};h=function(){var a=new d(this);this.bars.unshift(a)};d=function(a){this.el=document.createElement("div");this.el.style.backgroundColor=a.opts.bg;this.here=this.width=0;this.moving=!1;this.cont=a;c(this.el,l);a.el.appendChild(this.el)};d.prototype.go=function(a){a?(this.here=a,this.moving||(this.moving=!0,f.call(this))):this.moving&&f.call(this)};e=function(a){a=this.opts=a||{};var b;a.bg=a.bg||"#000";this.bars=[];b=this.el=document.createElement("div");c(this.el,
k);a.id&&(b.id=a.id);b.style.position=a.target?"relative":"fixed";a.target?a.target.insertBefore(b,a.target.firstChild):document.getElementsByTagName("body")[0].appendChild(b);h.call(this)};e.prototype.go=function(a){this.bars[0].go(a);100==a&&h.call(this)};return e}();

jQuery(function(b){function d(a,b){return gdn.definition("InfiniteScroll."+a,b)}function u(a,b){if(null===a||void 0===a)return!1;b=b||0;for(var E=window.pageYOffset,d=E+window.innerHeight,e=0,c=a;c&&!isNaN(c.offsetTop);)e+=c.offsetTop,c=c.offsetParent;return e+a.clientHeight>E-b&&e<=d+b}function x(a){O&&(F.css("visibility",a?"visible":"hidden"),P.toggle(a))}function G(a){var h=!1,c=!1;e=a-1;f=a+1;F=b("#Head, .BreadcrumbsWrapper, #Item_0, h2.CommentHeading, div.PageDescription, h1.HomepageTitle, nav.navbar-static-top, span.Breadcrumbs, #Content .DismissMessage, main.page-content .DismissMessage, #Frame > .Banner, #Frame > .Top, .well.search-form, .Top .Button.NewDiscussion");
k=b("#Content ul.DataList, main.page-content ul.DataList, #Content table.DataTable tbody, main.page-content table.DataTable tbody");y=b("div.MessageList.Discussion");l=b("#Content, main.page-content");k.children().first().find(":not(tr)").first().prepend('<a id="Page_'+a+'"/>');a===m&&(b("#PagerAfter").remove(),h=!0);1===a&&(b("#PagerBefore").remove(),c=!0);b(".Pager").css("visibility","hidden");h||l.find(".CommentForm").hide();x(c);h&&!c&&(a=v.height(),0<a&&(z.css("min-height",a),l.prepend(z)));
p=k.offset()||l.offset();c||location.hash||g.scrollTop(p.top)}function A(){if(!c){var a=b(".Item",k).filter(function(){return u(this)}),h=a.first(),d=a.last(),f=d.index(".DataList > .Item, tbody > .Item")+1,g=e*H+f+(w?1:0),a=e+Math.floor((f-a.length)/H)+1,f=0===e?u(y[0]):!1,h=w&&h[0]&&!f?"#"+h[0].id:"";d.length||(window.pageYOffset>p.top?(g=q,a=m):g=a=1);d=1!==a||w?t+"/p"+a+h:t;d!==window.location.href&&history.replaceState(null,null,d);n.is(":focus")||n.val(a);Q.text(g);I.go(g/q*99.9)}}function J(a){a=
b('<div class="ScrollProgress"/>').insertBefore(a);b.fn.spin?a.spin({lines:9,radius:6,length:6,width:3}):a.html('<span class="Progress"/>')}function R(a){c=!0;J(a);b.get(t+"/p"+f+"?DeliveryType=VIEW&InnerList=1",function(h){b(h).appendTo(k).first().addClass("InfScrollHighlight").find(":not(tr)").first().prepend('<a id="Page_'+f+'"/>');f+=1;f>m&&(l.find(".CommentForm").show(),b(a).remove());p=k.offset();g.trigger("CommentPagingComplete")}).always(function(){c=!1;b(".ScrollProgress").remove();A()})}
function S(a){c=!0;J(a);b.get(t+"/p"+e,function(h){var d=g.height(),c=v.scrollTop();b("#Content ul.DataList, main.page-content ul.DataList, #Content table.DataTable tbody, main.page-content table.DataTable tbody",h).children().prependTo(k).last().addClass("InfScrollHighlight").end().first().find(":not(tr)").first().prepend('<a id="Page_'+e+'"/>');b("div.ItemDiscussion",h).appendTo(y);--e;0===e&&(b(a).remove(),x(!0));z.remove();g.scrollTop(c+g.height()-d);p=k.offset();g.trigger("CommentPagingComplete")}).always(function(){c=
!1;b(".ScrollProgress").remove();A()})}function r(){var a,b;a=Date.now();a>K+100&&(K=a,A());c||1>e&&m<f||(a=document.getElementById("PagerAfter"),b=document.getElementById("PagerBefore"),u(a,L)&&f<=m?R(a):u(b,L)&&0<e&&S(b))}function M(a){-1===a?a=p.top+k.height():2>a?(a=w?b("#Item_0").offset().top:0,x(!0)):a=b("#Page_"+a).offset().top;return b("html, body").animate({scrollTop:a})}function B(a){if(!c){var d=a;2>a&&(a=-1===a?m:1);e<a&&a<f?M(d).promise().always(function(){r()}):(c=!0,l.css("visibility",
"hidden"),C.show(),b.get(t+"/p"+a,function(e){l.replaceWith(b("#Content, main.page-content",e));G(a);M(d).promise().always(function(){c=!1;r()})}).always(function(){l.css("visibility","visible");C.hide()}))}}var v=b(window),g=b(document),c,e=d("Page",1)-1,m=d("TotalPages",1),f=e+2,q=d("CountItems"),H=d("PerPage"),w=d("InDiscussion",!1),O=d("HideHead",!0),L=d("Treshold",300),t=d("Url",!1),z=b("<div/>"),K=0,D=null,I,Q=b("#InfScrollNav .NavIndex"),P=b("#Panel, aside.page-sidebar"),n=b("#InfScrollJT"),
N=b("#Frame"),C=b("#PageProgress"),F,k,p,y,l;!N.length&&b.fn.spin&&(N=b("body > *"),C.spin({lines:11,radius:10,length:10,width:4}));I=new Nanobar({bg:1!==q?d("ProgressBg"):"transparent",id:"ProgressBar",target:0!==d("NavStyle",0)?b("#InfScrollNav .PageCount")[0]:null});c=!0;setTimeout(function(){location.hash&&(location.hash=location.hash.toString());c=!1;r()},500);G(d("Page",1));v.scroll(r);v.scroll(function(){null!==D&&clearTimeout(D);D=setTimeout(r,100)});b("#InfScrollNav .JTT").click(function(a){a.preventDefault();
B(0)});b("#InfScrollNav .JTB").click(function(a){a.preventDefault();B(-1)});g.click(function(a){var c=b("#InfScrollNav");b(a.target).closest(c).length?b(a.target).closest("#InfScrollNav .PageCount").length&&(c.addClass("active"),d("Mobile",!1)&&1===d("NavStyle",0)||n.focus()):c.removeClass("active")});g.keypress(function(a){b(a.target).is("input, textarea")||(a="undefined"===a.which?a.keyCode:a.which,String.fromCharCode(a)===d("Hotkey","j").charAt(0)?b("#InfScrollNav .PageCount").click():13===a&&
b("#InfScrollNav").is(".active")&&b("#InfScrollNav form.JumpTo").submit())});n.focus(function(){n.one("mouseup",function(){n.select();return!1}).select()});b("#InfScrollNav form.JumpTo").submit(function(){var a=parseInt(n.val(),10);0<a&&a<=m&&B(a);return!1});g.on("CommentAdded",function(){q+=1;b("#InfScrollNav .PageCount span.small").text(q);r()})});
