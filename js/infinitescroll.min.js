var Nanobar=function(){var c,d,e,f,g,h,k={width:"100%",height:"4px",zIndex:9999,top:"0"},l={width:0,height:"100%",clear:"both",transition:"height .3s"};c=function(a,b){for(var c in b)a.style[c]=b[c];a.style["float"]="left"};f=function(){var a=this,b=this.width-this.here;0.1>b&&-0.1<b?(g.call(this,this.here),this.moving=!1,100==this.width&&(this.el.style.height=0,setTimeout(function(){a.cont.el.removeChild(a.el)},300))):(g.call(this,this.width-b/4),setTimeout(function(){a.go()},16))};g=function(a){this.width=
a;this.el.style.width=this.width+"%"};h=function(){var a=new d(this);this.bars.unshift(a)};d=function(a){this.el=document.createElement("div");this.el.style.backgroundColor=a.opts.bg;this.here=this.width=0;this.moving=!1;this.cont=a;c(this.el,l);a.el.appendChild(this.el)};d.prototype.go=function(a){a?(this.here=a,this.moving||(this.moving=!0,f.call(this))):this.moving&&f.call(this)};e=function(a){a=this.opts=a||{};var b;a.bg=a.bg||"#000";this.bars=[];b=this.el=document.createElement("div");c(this.el,
k);a.id&&(b.id=a.id);b.style.position=a.target?"relative":"fixed";a.target?a.target.insertBefore(b,a.target.firstChild):document.getElementsByTagName("body")[0].appendChild(b);h.call(this)};e.prototype.go=function(a){this.bars[0].go(a);100==a&&h.call(this)};return e}();

jQuery(function(b){function c(a,b){return gdn.definition("InfiniteScroll."+a,b)}function u(a,b){if(null===a||void 0===a)return!1;b=b||0;for(var E=window.pageYOffset,c=E+window.innerHeight,d=0,e=a;e&&!isNaN(e.offsetTop);)d+=e.offsetTop,e=e.offsetParent;return d+a.clientHeight>E-b&&d<=c+b}function x(a){O&&(F.css("visibility",a?"visible":"hidden"),P.toggle(a))}function G(a){var l=!1,c=!1;d=a-1;f=a+1;F=b("#Head, .BreadcrumbsWrapper, #Item_0, h2.CommentHeading, div.PageDescription, h1.HomepageTitle, nav.navbar-static-top, .ChildCategoryList, span.Breadcrumbs, #Content .DismissMessage, main.page-content .DismissMessage, #Frame > .Banner, #Frame > .Top, .well.search-form, .Top .Button.NewDiscussion");
k=b("#Content ul.DataList.Comments, main.page-content ul.DataList.Comments, #Content ul.DataList.Discussions, main.page-content ul.DataList.Discussions, #Content table.DataTable.DiscussionsTable tbody, main.page-content table.DataTable.DiscussionsTable tbody");y=b("div.MessageList.Discussion");m=b("#Content, main.page-content");k.children().first().find(":not(tr)").first().prepend('<a id="Page_'+a+'"/>');a===n&&(b("#PagerAfter").remove(),l=!0);1===a&&(b("#PagerBefore").remove(),c=!0);b(".Pager").css("visibility",
"hidden");l||m.find(".CommentForm").hide();x(c);l&&!c&&(a=v.height(),0<a&&(z.css("min-height",a),m.prepend(z)));p=k.offset()||m.offset();c||location.hash||g.scrollTop(p.top)}function A(){if(!e){var a=b(".Item",k).filter(function(){return u(this)}),l=a.first(),c=a.last(),f=c.index(".DataList.Comments > .Item, .DataList.Discussions > .Item, tbody > .Item")+1,g=d*H+f+(w?1:0),a=d+Math.floor((f-a.length)/H)+1,f=0===d?u(y[0]):!1,l=w&&l[0]&&!f?"#"+l[0].id:"";c.length||(window.pageYOffset>p.top?(g=q,a=n):
g=a=1);c=1!==a||w?t+"/p"+a+l:t;c!==window.location.href&&Q&&history.replaceState(null,null,c);h.is(":focus")||h.val(a).data("page",a.toString());R.text(g);I.go(g/q*99.9)}}function J(a){a=b('<div class="ScrollProgress"/>').insertBefore(a);b.fn.spin?a.spin({lines:9,radius:6,length:6,width:3}):a.html('<span class="Progress"/>')}function S(a){e=!0;J(a);b.get(t+"/p"+f+"?DeliveryType=VIEW&InnerList=1",function(c){b(c).appendTo(k).first().addClass("InfScrollHighlight").find(":not(tr)").first().prepend('<a id="Page_'+
f+'"/>');f+=1;f>n&&(m.find(".CommentForm").show(),b(a).remove());p=k.offset();g.trigger("CommentPagingComplete")}).always(function(){e=!1;b(".ScrollProgress").remove();A()})}function T(a){e=!0;J(a);b.get(t+"/p"+d,function(c){var e=g.height(),f=v.scrollTop();b("#Content ul.DataList.Comments, main.page-content ul.DataList.Comments, #Content ul.DataList.Discussions, main.page-content ul.DataList.Discussions, #Content table.DataTable.DiscussionsTable tbody, main.page-content table.DataTable.DiscussionsTable tbody",
c).children().prependTo(k).last().addClass("InfScrollHighlight").end().first().find(":not(tr)").first().prepend('<a id="Page_'+d+'"/>');b("div.ItemDiscussion",c).appendTo(y);--d;0===d&&(b(a).remove(),x(!0));z.remove();g.scrollTop(f+g.height()-e);p=k.offset();g.trigger("CommentPagingComplete")}).always(function(){e=!1;b(".ScrollProgress").remove();A()})}function r(){var a,b;a=Date.now();a>K+100&&(K=a,A());e||1>d&&n<f||(a=document.getElementById("PagerAfter"),b=document.getElementById("PagerBefore"),
u(a,L)&&f<=n?S(a):u(b,L)&&0<d&&T(b))}function M(a){-1===a?a=p.top+k.height():2>a?(a=w?b("#Item_0").offset().top:0,x(!0)):a=b("#Page_"+a).offset().top;return b("html, body").animate({scrollTop:a})}function B(a){if(!e){var c=a;2>a&&(a=-1===a?n:1);d<a&&a<f?M(c).promise().always(function(){r()}):(e=!0,m.css("visibility","hidden"),C.show(),b.get(t+"/p"+a,function(d){m.replaceWith(b("#Content, main.page-content",d));G(a);M(c).promise().always(function(){e=!1;r()})}).always(function(){m.css("visibility",
"visible");C.hide()}))}}var v=b(window),g=b(document),Q=!(!window.history||!window.history.replaceState),e,d=c("Page",1)-1,n=c("TotalPages",1),f=d+2,q=c("CountItems"),H=c("PerPage"),w=c("InDiscussion",!1),O=c("HideHead",!0),L=c("Treshold",300),t=c("Url",!1),z=b("<div/>"),K=0,D=null,I,R=b("#InfScrollNav .NavIndex"),P=b("#Panel, aside.page-sidebar"),h=b("#InfScrollJT"),N=b("#Frame"),C=b("#PageProgress"),F,k,p,y,m;!N.length&&b.fn.spin&&(N=b("body > *"),C.spin({lines:11,radius:10,length:10,width:4}));
I=new Nanobar({bg:1!==q?c("ProgressBg"):"transparent",id:"ProgressBar",target:0!==c("NavStyle",0)?b("#InfScrollNav .PageCount")[0]:null});e=!0;setTimeout(function(){location.hash&&(location.hash=location.hash.toString());e=!1;r()},500);G(c("Page",1));v.scroll(r);v.scroll(function(){null!==D&&clearTimeout(D);D=setTimeout(r,100)});b("#InfScrollNav .JTT").click(function(a){a.preventDefault();B(0)});b("#InfScrollNav .JTB").click(function(a){a.preventDefault();B(-1)});g.click(function(a){var d=b("#InfScrollNav");
b(a.target).closest(d).length?b(a.target).closest("#InfScrollNav .PageCount").length&&(d.addClass("active"),c("Mobile",!1)&&1===c("NavStyle",0)||h.focus()):d.removeClass("active")});g.keypress(function(a){b(a.target).is("input, textarea")||(a="undefined"===a.which?a.keyCode:a.which,String.fromCharCode(a)===c("Hotkey","j").charAt(0)?b("#InfScrollNav .PageCount").click():13===a&&b("#InfScrollNav").is(".active")&&b("#InfScrollNav form.JumpTo").submit())});h.focus(function(){h.one("mouseup",function(){h.select();
return!1}).select()}).focusout(function(){h.data("page")!==h.val()&&c("Mobile",!1)&&h.data("page",h.val()).parent().submit()});b("#InfScrollNav form.JumpTo").submit(function(){var a=parseInt(h.val(),10);0<a&&a<=n&&B(a);return!1});g.on("CommentAdded",function(){q+=1;b("#InfScrollNav .PageCount span.small").text(q);r()})});
