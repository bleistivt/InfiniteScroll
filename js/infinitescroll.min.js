jQuery(function(b){function c(a,b){return gdn.definition("InfiniteScroll."+a,b)}function u(a,b){if(null===a||void 0===a)return!1;b=b||0;for(var E=window.pageYOffset,c=E+window.innerHeight,e=0,d=a;d&&!isNaN(d.offsetTop);)e+=d.offsetTop,d=d.offsetParent;return e+a.clientHeight>E-b&&e<=c+b}function x(a){P&&(F.css("visibility",a?"visible":"hidden"),Q.toggle(a))}function G(a){var k=!1,c=!1;e=a-1;f=a+1;F=b("#Head, .BreadcrumbsWrapper, #Item_0, h2.CommentHeading, div.PageDescription, h1.HomepageTitle, nav.navbar-static-top, .ChildCategoryList, span.Breadcrumbs, #Content .DismissMessage, main.page-content .DismissMessage, #Frame > .Banner, #Frame > .Top, .well.search-form, .Top .Button.NewDiscussion");
l=b("#Content ul.DataList.Comments, main.page-content ul.DataList.Comments, #Content ul.DataList.Discussions, main.page-content ul.DataList.Discussions, #Content table.DataTable.DiscussionsTable tbody, main.page-content table.DataTable.DiscussionsTable tbody");y=b("div.MessageList.Discussion");m=b("#Content, main.page-content");l.children().first().find(":not(tr)").first().prepend('<a id="Page_'+a+'"/>');a===n&&(b("#PagerAfter").remove(),k=!0);1===a&&(b("#PagerBefore").remove(),c=!0);b(".Pager").css("visibility",
"hidden");k||m.find(".CommentForm").hide();x(c);k&&!c&&(a=v.height(),0<a&&(z.css("min-height",a),m.prepend(z)));q=l.offset()||m.offset();c||location.hash||g.scrollTop(q.top)}function A(){if(!d){var a=b(".Item",l).filter(function(a,b){return u(b)}),k=a.first(),c=a.last(),g=c.index(".DataList.Comments > .Item, .DataList.Discussions > .Item, tbody > .Item")+1,f=e*H+g+(w?1:0),a=e+Math.floor((g-a.length)/H)+1,g=0===e?u(y[0]):!1,k=w&&k[0]&&!g?"#"+k[0].id:"";c.length||(window.pageYOffset>q.top?(f=r,a=n):
a=f=1);c=1!==a||w?t+"/p"+a+k:t;c!==window.location.href&&R&&history.replaceState(null,null,c);h.is(":focus")||h.val(a).data("page",a.toString());S.text(I?a:f);J.go(f/r*99.9)}}function K(a){a=b('<div class="ScrollProgress"/>').insertBefore(a);b.fn.spin?a.spin({lines:9,radius:6,length:6,width:3}):a.html('<span class="Progress"/>')}function T(a){d=!0;K(a);b.get(t+"/p"+f+"?DeliveryType=VIEW&InnerList=1",function(c){b(c).appendTo(l).first().addClass("InfScrollHighlight").find(":not(tr)").first().prepend('<a id="Page_'+
f+'"/>');f+=1;f>n&&(m.find(".CommentForm").show(),b(a).remove());g.trigger("CommentPagingComplete")}).always(function(){d=!1;b(".ScrollProgress").remove();A()})}function U(a){d=!0;K(a);b.get(t+"/p"+e,function(c){var d=g.height(),f=v.scrollTop();b("#Content ul.DataList.Comments, main.page-content ul.DataList.Comments, #Content ul.DataList.Discussions, main.page-content ul.DataList.Discussions, #Content table.DataTable.DiscussionsTable tbody, main.page-content table.DataTable.DiscussionsTable tbody",
c).children().prependTo(l).last().addClass("InfScrollHighlight").end().first().find(":not(tr)").first().prepend('<a id="Page_'+e+'"/>');b("div.ItemDiscussion",c).appendTo(y);--e;0===e&&(b(a).remove(),x(!0));z.remove();g.scrollTop(f+g.height()-d);q=l.offset();g.trigger("CommentPagingComplete")}).always(function(){d=!1;b(".ScrollProgress").remove();A()})}function p(){var a,b;a=Date.now();a>L+100&&(L=a,A());d||1>e&&n<f||(a=document.getElementById("PagerAfter"),b=document.getElementById("PagerBefore"),
u(a,M)&&f<=n?T(a):u(b,M)&&0<e&&U(b))}function N(a){-1===a?a=q.top+l.height():2>a?(a=w?b("#Item_0").offset().top:0,x(!0)):a=b("#Page_"+a).offset().top;return b("html, body").animate({scrollTop:a})}function B(a){if(!d){var c=a;2>a&&(a=-1===a?n:1);e<a&&a<f?N(c).promise().always(function(){p()}):(d=!0,m.css("visibility","hidden"),C.show(),b.get(t+"/p"+a,function(e){m.replaceWith(b("#Content, main.page-content",e));G(a);N(c).promise().always(function(){d=!1;p()})}).always(function(){m.css("visibility",
"visible");C.hide()}))}}var v=b(window),g=b(document),R=!(!window.history||!window.history.replaceState),d,e=c("Page",1)-1,n=c("TotalPages",1),f=e+2,r=c("CountItems"),H=c("PerPage"),w=c("InDiscussion",!1),P=c("HideHead",!0),I=c("PageNumber",!1),M=c("Treshold",300),t=c("Url",!1),z=b("<div/>"),L=0,D=null,J,S=b("#InfScrollNav .NavIndex"),Q=b("#Panel, aside.page-sidebar"),h=b("#InfScrollJT"),O=b("#Frame"),C=b("#PageProgress"),F,l,q,y,m;!O.length&&b.fn.spin&&(O=b("body > *"),C.spin({lines:11,radius:10,
length:10,width:4}));J=new Nanobar({bg:1!==r?c("ProgressBg"):"transparent",id:"ProgressBar",target:0!==c("NavStyle",0)?b("#InfScrollNav .PageCount")[0]:null});d=!0;setTimeout(function(){location.hash&&(location.hash=location.hash.toString());d=!1;p()},500);G(c("Page",1));v.scroll(p);v.scroll(function(){null!==D&&clearTimeout(D);D=setTimeout(p,100)});b("#InfScrollNav .JTT").click(function(a){a.preventDefault();B(0)});b("#InfScrollNav .JTB").click(function(a){a.preventDefault();B(-1)});g.click(function(a){var d=
b("#InfScrollNav");b(a.target).closest(d).length?b(a.target).closest("#InfScrollNav .PageCount").length&&(d.addClass("active"),c("Mobile",!1)&&1===c("NavStyle",0)||h.focus()):d.removeClass("active")});g.keypress(function(a){b(a.target).is("input, textarea")||(a="undefined"===a.which?a.keyCode:a.which,String.fromCharCode(a)===c("Hotkey","j").charAt(0)?b("#InfScrollNav .PageCount").click():13===a&&b("#InfScrollNav").is(".active")&&b("#InfScrollNav form.JumpTo").submit())});h.focus(function(){h.one("mouseup",
function(){h.select();return!1}).select()}).focusout(function(){h.data("page")!==h.val()&&c("Mobile",!1)&&h.data("page",h.val()).parent().submit()});b("#InfScrollNav form.JumpTo").submit(function(){var a=parseInt(h.val(),10);0<a&&a<=n&&B(a);return!1});g.on("CommentAdded",function(){r+=1;I||b("#InfScrollNav .PageCount span.small").text(r);p()})});
